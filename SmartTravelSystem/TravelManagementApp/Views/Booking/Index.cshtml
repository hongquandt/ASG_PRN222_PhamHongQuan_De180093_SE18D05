@model IEnumerable<TravelDataAccess.Models.Booking>
@{
    ViewData["Title"] = "My Bookings";
    var pendingOnly = ViewBag.PendingOnly ?? false;
}

<div class="row mb-4">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <h2 class="fw-bold mb-0">
                <span style="font-size: 2rem;">üé´</span> My Bookings
            </h2>
            <div class="d-flex gap-2">
                <a asp-action="Index" asp-route-pendingOnly="false" 
                   class="btn @(!pendingOnly ? "btn-primary" : "btn-outline-primary")" 
                   style="border-radius: 10px; font-weight: 600;">
                    üìã All Bookings
                </a>
                <a asp-action="Index" asp-route-pendingOnly="true" 
                   class="btn @(pendingOnly ? "btn-primary" : "btn-outline-primary")" 
                   style="border-radius: 10px; font-weight: 600;">
                    ‚è≥ Pending Only
                </a>
                <a asp-action="Create" class="btn btn-success" style="border-radius: 10px; font-weight: 600;">
                    ‚ûï New Booking
                </a>
            </div>
        </div>
        <hr style="border-top: 3px solid #667eea; opacity: 0.3;" />
    </div>
</div>

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-hover align-middle" style="border-radius: 10px; overflow: hidden;">
            <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <tr>
                    <th style="padding: 15px;">Booking ID</th>
                    @if ((bool)(ViewBag.IsAdmin ?? false))
                    {
                        <th>Customer</th>
                    }
                    <th>Destination</th>
                    <th>Trip Code</th>
                    <th>Price</th>
                    <th>Booking Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model)
                {
                    <tr style="background: white;">
                        <td class="fw-bold">#@booking.ID</td>
                         @if ((bool)(ViewBag.IsAdmin ?? false))
                        {
                            <td>@booking.Customer?.FullName</td>
                        }
                        <td>
                            <span style="font-size: 1.2rem;">üìç</span> 
                            <strong>@booking.Trip?.Destination</strong>
                        </td>
                        <td>
                            <span class="badge bg-info text-dark">@booking.Trip?.Code</span>
                        </td>
                        <td class="fw-bold" style="color: #764ba2;">
                            $@booking.Trip?.Price.ToString("N2")
                        </td>
                        <td>@booking.BookingDate.ToString("MMM dd, yyyy")</td>
                        <td>
                            @if (booking.Status == "Pending")
                            {
                                <span class="badge bg-warning text-dark" style="border-radius: 20px; padding: 5px 12px;">‚è≥ Pending</span>
                            }
                            else if (booking.Status == "Confirmed")
                            {
                                <span class="badge bg-success" style="border-radius: 20px; padding: 5px 12px;">‚úÖ Confirmed</span>
                            }
                            else
                            {
                                <span class="badge bg-danger" style="border-radius: 20px; padding: 5px 12px;">‚ùå Cancelled</span>
                            }
                        </td>
                        <td>
                            @if ((bool)(ViewBag.IsAdmin ?? false))
                            {
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" 
                                            data-bs-toggle="dropdown" aria-expanded="false" style="border-radius: 8px;">
                                        Update Status
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <form asp-action="Edit" asp-route-id="@booking.ID" method="post" class="d-inline">
                                                <input type="hidden" name="status" value="Pending" />
                                                <button type="submit" class="dropdown-item">‚è≥ Pending</button>
                                            </form>
                                        </li>
                                        <li>
                                            <form asp-action="Edit" asp-route-id="@booking.ID" method="post" class="d-inline">
                                                <input type="hidden" name="status" value="Confirmed" />
                                                <button type="submit" class="dropdown-item">‚úÖ Confirmed</button>
                                            </form>
                                        </li>
                                        <li>
                                            <form asp-action="Edit" asp-route-id="@booking.ID" method="post" class="d-inline">
                                                <input type="hidden" name="status" value="Cancelled" />
                                                <button type="submit" class="dropdown-item">‚ùå Cancelled</button>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                            }
                            else
                            {
                                @if (booking.Status != "Cancelled")
                                {
                                    <form asp-action="Edit" asp-route-id="@booking.ID" method="post" class="d-inline">
                                        <input type="hidden" name="status" value="Cancelled" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger" style="border-radius: 8px;"
                                                onclick="return confirm('Are you sure you want to cancel this booking?');">
                                            ‚ùå Cancel
                                        </button>
                                    </form>
                                }
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mt-3">
        <div class="alert alert-info" role="alert">
            <strong>‚ÑπÔ∏è Total Bookings:</strong> @Model.Count()
        </div>
    </div>
}
else
{
    <div class="text-center py-5">
        <div style="font-size: 4rem; opacity: 0.3;">üé´</div>
        <h4 class="text-muted">
            @if (pendingOnly)
            {
                <text>No pending bookings found</text>
            }
            else
            {
                <text>You haven't made any bookings yet</text>
            }
        </h4>
        <a asp-action="Create" class="btn btn-primary mt-3" 
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; padding: 12px 30px; font-weight: 600;">
            Make Your First Booking
        </a>
    </div>
}
